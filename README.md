# Лабораторная работа 6: Рефакторинг и Code Smells



## Цель работы

Научиться находить code smells в реальном коде и применять рефакторинг для улучшения его структуры без изменения поведения.



## Обнаруженные проблемы качества кода



### 1. Длинный метод (Long Method)

Исходная функция `process\_checkout()` содержала более 50 строк кода и совмещала множество различных ответственностей в одной функции.



### 2. Магические числа (Magic Numbers)

В коде были разбросаны числовые значения без объяснения:

\- `0.10`, `0.20`, `0.05` - проценты скидок

\- `0.21` - процент налога

\- `50`, `10` - фиксированные скидки

\- `200`, `100` - пороговые значения для скидок



### 3. Сложные условные конструкции

Вложенные if/elif операторы для расчета скидок, где логика скидок перемешана с основной бизнес-логикой.



### 4. Нарушение принципа единственной ответственности

Одна функция выполняла: парсинг данных, валидацию, расчеты, генерацию ID и формирование ответа.



## Выполненные рефакторинги



### 1. Извлечение методов (Extract Method)

Большая функция `process\_checkout()` разделена на 8 небольших функций, каждая с одной ответственностью.



### 2. Замена магических чисел константами

Все числовые значения вынесены в именованные константы:

```python

DEFAULT\_CURRENCY = "USD"

DEFAULT\_TAX\_RATE = 0.21

SAVE20\_THRESHOLD = 200

VIP\_THRESHOLD = 100
```


### 3. Введение объекта данных (DTO)

Создан класс OrderRequest для группировки связанных данных вместо использования кортежей.

### 4. Разделение сложной логики

Логика расчета скидок разделена на отдельные методы:

calculate_discount() - основная функция

_calculate_save20_discount() - для купона SAVE20

_calculate_vip_discount() - для VIP купона

### Выводы

После рефакторинга код стал:

Читаемее - каждая функция выполняет одну задачу

Поддерживаемее - изменения локализованы

Тестируемее - можно тестировать компоненты изолированно

Расширяемее - легко добавлять новую функциональность

Все тесты проходят успешно, что подтверждает сохранение функциональности после рефакторинга.



